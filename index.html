 <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dream Widget</title>
    
    <link href="https://fonts.cdnfonts.com/css/gluten" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/playpen-sans" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/rangile" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/tasty" rel="stylesheet">
    <link href="https://fonts.cdnfonts.com/css/babydoll" rel="stylesheet">

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <style>
        :root { --p-pink: #F5E6F5; --a-pink: #EDD3E7; }
        body { margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; background: transparent; overflow-x: hidden; }
        
        /* INTRO STRIP */
        #intro-btn { 
            cursor: pointer; width: 450px; height: 75px; 
            background: url('https://i.pinimg.com/736x/ff/d3/71/ffd371f5687960d2338380194f3adefc.jpg') no-repeat center/contain;
            display: flex; justify-content: center; align-items: center;
            color: white; font-family: 'Gluten'; font-size: 22px;
            transition: transform 0.2s;
        }
        #intro-btn:hover { transform: scale(1.05); }

        /* ENVELOPE & SEAL */
        #envelope { display: none; width: 300px; margin-top: 20px; text-align: center; }
        .seal { width: 100px; cursor: pointer; transition: 0.3s; }
        .bounce { animation: bounce 1s infinite; }

        /* THE PAGE */
        #page-wrapper { display: none; width: 400px; position: relative; }
        #page-bg { 
            width: 100%; min-height: 550px; 
            background: url('https://i.pinimg.com/1200x/0c/83/93/0c839340ccbd8c5f89d9c09a555ae67c.jpg') center/cover;
            padding: 90px 50px; box-sizing: border-box; position: relative;
        }
        .page-input { 
            background: transparent; border: none; outline: none; font-family: 'Babydoll'; 
            font-size: 18px; width: 100%; min-height: 350px; resize: none; line-height: 1.6;
        }

        /* BULLET & ICONS */
        .bullet { width: 30px; cursor: pointer; position: absolute; left: 15px; top: 95px; }
        #lover { position: absolute; top: 15px; right: 20px; width: 50px; cursor: pointer; transition: 0.3s; }
        #speech-bubble { 
            display: none; position: absolute; top: 10px; right: 80px; background: white; 
            padding: 8px 12px; border-radius: 15px; font-size: 14px; font-family: 'Playpen Sans';
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); color: var(--a-pink);
        }

        /* PASSWORD SYSTEM */
        #pass-screen { display: none; text-align: center; z-index: 100; }
        .pass-bg { 
            width: 400px; height: 450px; background: url('https://i.pinimg.com/736x/55/8f/89/558f89fbd04ac675c094ed2808ab78d2.jpg') no-repeat center/contain;
            position: relative; 
        }
        .pass-box { 
            position: absolute; top: 95px; left: 50%; transform: translateX(-50%); width: 230px; height: 310px;
            background: url('https://i.pinimg.com/736x/dd/a1/98/dda198020305d044b4fe3efed1454aad.jpg') no-repeat center/contain;
        }
        .grid { position: absolute; top: 100px; left: 30px; display: grid; grid-template-columns: repeat(3, 58px); grid-template-rows: repeat(4, 48px); }
        .key { width: 50px; height: 45px; cursor: pointer; }

        /* COOKIES */
        .cookies { display: flex; justify-content: center; gap: 15px; margin-top: 15px; }
        .cookie { font-size: 35px; filter: sepia(1); transition: 0.5s; }
        .frosted { filter: hue-rotate(300deg) saturate(2); }
        .burnt { filter: brightness(0); transform: scale(0.85); }

        #jumpscare { display: none; position: fixed; inset: 0; background: black; z-index: 1000; justify-content: center; align-items: center; }

        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
    </style>
</head>
<body>

    <div id="player1"></div><div id="player2"></div>

    <div id="intro-btn" onclick="startIntro()">Ready to make a change?</div>

    <div id="envelope">
        <img src="https://i.pinimg.com/1200x/4c/80/77/4c807778ddfbcebbd3520f9b21b5c21a.jpg" class="seal bounce" onclick="openLetter()">
    </div>

    <div id="pass-screen">
        <h2 style="font-family:'Rangile'; color:#EDD3E7">What's the password?</h2>
        <div class="pass-bg">
            <div class="pass-box"><div class="grid" id="pad"></div></div>
        </div>
        <div class="cookies">
            <div id="ck1" class="cookie">üç™</div><div id="ck2" class="cookie">üç™</div><div id="ck3" class="cookie">üç™</div>
        </div>
        <button onclick="submitPass()" style="margin-top:20px; font-family:'Rangile'; background:#EDD3E7; border:none; color:white; padding:12px 30px; border-radius:25px; cursor:pointer; font-size: 18px;">Done!</button>
    </div>

    <div id="page-wrapper">
        <div style="display:flex; justify-content:center; margin-bottom:10px;">
            <img src="https://i.pinimg.com/736x/02/73/11/027311452148282f9e0a95da919353cb.jpg" style="width:180px; cursor:pointer;" onclick="duplicate()">
        </div>
        <div id="page-bg">
            <img src="https://i.pinimg.com/originals/13/22/60/1322609ad9b6a08e9807fead886c808d.gif" class="bullet" id="bullet-icon">
            <img src="https://i.pinimg.com/1200x/45/50/84/455084972042bdcb6191dc8e0752b777.jpg" id="lover" onmouseover="showBubble()" onmouseout="hideBubble()" onclick="callHelper()">
            <div id="speech-bubble">need help?</div>
            <textarea id="main-text" class="page-input" placeholder="Start typing here..."></textarea>
        </div>
    </div>

    <img src="https://i.pinimg.com/736x/1d/82/af/1d82af579a52b2af6d07b377052916e3.jpg" id="helper-img" style="display:none; position:fixed; bottom:20px; right:20px; width:80px; cursor:pointer;" onclick="showMenu()">

    <div id="jumpscare"><img src="https://i.pinimg.com/736x/af/8b/0a/af8b0ac2dd0ea5fd38be9d2ec08e5340.jpg" width="85%"></div>

    <script>
        const _supabase = supabase.createClient('https://memmuagjbhuvtkoxbpqt.supabase.co', 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1lbW11YWdqYmh1dnRrb3hicHF0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE1NDU1NzIsImV4cCI6MjA4NzEyMTU3Mn0.jWq9fHmAt4Kw-7GWJdqFET0ygzgHdLahfjebqhuHKLU');
        const user = new URLSearchParams(window.location.search).get('user') || 'sliceofkeike';

        let p1, p2, currentInput = "", fails = 0;
        const pop = new Audio('https://www.soundjay.com/buttons/sounds/button-20.mp3');
        const phone = new Audio('https://www.soundjay.com/buttons/sounds/button-3.mp3');
        const chime = new Audio('https://www.soundjay.com/buttons/sounds/button-09.mp3');

        function onYouTubeIframeAPIReady() {
            p1 = new YT.Player('player1', { height: '0', width: '0', videoId: 'vQM2EJZqzko' });
            p2 = new YT.Player('player2', { height: '0', width: '0', videoId: 'PUhHtqTdbVw' });
        }

        const pad = document.getElementById('pad');
        for(let i=1; i<=12; i++){
            let k = document.createElement('div'); k.className = 'key';
            if(i<=9) k.onclick = () => { phone.play(); currentInput += i; };
            if(i==11) k.onclick = () => { phone.play(); currentInput += 0; };
            pad.appendChild(k);
        }

        async function startIntro() {
            pop.play(); p1.playVideo();
            document.getElementById('intro-btn').style.display = 'none';
            let { data } = await _supabase.from('widget_data').select('*').eq('user_name', user).single();
            if(!data) {
                await _supabase.from('widget_data').insert([{ user_name: user, content: '', password: '0307', is_locked: true }]);
                return startIntro();
            }
            if(data.is_locked) document.getElementById('pass-screen').style.display = 'block';
            else showEnvelope();
        }

        async function submitPass() {
            let { data } = await _supabase.from('widget_data').select('password').eq('user_name', user).single();
            if(currentInput === data.password) { chime.play(); showEnvelope(); }
            else { 
                fails++; currentInput = "";
                if(fails <= 3) document.getElementById(`ck${fails}`).classList.add('frosted');
                if(fails >= 4) { 
                    document.querySelectorAll('.cookie').forEach(c => c.classList.add('burnt')); 
                    document.getElementById('jumpscare').style.display='flex';
                    new Audio('https://www.soundjay.com/misc/sounds/fail-buzzer-01.mp3').play();
                }
            }
        }

        function showEnvelope() { document.getElementById('pass-screen').style.display='none'; document.getElementById('envelope').style.display='block'; }
        function openLetter() { pop.play(); p1.stopVideo(); p2.playVideo(); document.getElementById('envelope').style.display='none'; document.getElementById('page-wrapper').style.display='block'; loadContent(); }

        async function loadContent() {
            let { data } = await _supabase.from('widget_data').select('content').eq('user_name', user).single();
            document.getElementById('main-text').value = data.content;
        }

        document.getElementById('main-text').oninput = async (e) => {
            await _supabase.from('widget_data').update({ content: e.target.value }).eq('user_name', user);
        };

        function showBubble() { document.getElementById('speech-bubble').style.display = 'block'; }
        function hideBubble() { document.getElementById('speech-bubble').style.display = 'none'; }
        function callHelper() { pop.play(); document.getElementById('lover').style.display='none'; document.getElementById('helper-img').style.display='block'; }

        function duplicate() {
            const n = prompt("New Page Name:");
            if(n) {
                const url = window.location.origin + window.location.pathname + "?user=" + n;
                alert("New Page URL: " + url);
            }
        }

        var tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api"; document.head.appendChild(tag);
    </script>
</body>
</html>
